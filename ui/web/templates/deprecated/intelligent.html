<!-- Copyright (c) Abstract Machines
SPDX-License-Identifier: Apache-2.0 -->

{{ define "intelligent" }}
    <!doctype html>
    <html lang="en">
        <head>
            <title></title>
            {{ template "header" }}
        </head>
        <body>
            {{ template "navbar" }}
            <div class="main-content">
                <div class="container-fluid-1">
                    <div class="row-mb-3">
                        <div class="col-12 mx-auto">
                            <!-- 短路触发弹框 -->
                            <div 
                                class="modal fade" 
                                id="shortCircuitModal" 
                                tabindex="-1" 
                                role="dialog" 
                                aria-labelledby="shortCircuitModalLabel" 
                                data-bs-backdrop="static" 
                                data-bs-keyboard="false" 
                                aria-hidden="true"
                            >
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content" style="width: 580px;">
                                        <div class="modal-header">
                                            <h1 class="modal-title" id="shortCircuitModalLabel">设备设置</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"aria-label="Close" ></button>
                                        </div>
                                        <div class="modal-body">
                                        </div>
                                        <div class="modal-footer">
                                            <button 
                                                type="button" 
                                                class="btn btn-secondary" 
                                                data-bs-dismiss="modal" 
                                            >
                                                <i class="fa-solid fa-xmark"></i> 取消
                                            </button>
                                            <button type="button" class="btn body-button" id="confirm-btn-addRadioFreqModal">
                                                <i class="fa-solid fa-floppy-disk"></i> 确定
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="table-responsive table-container">
                                <div class="row buttons mb-3">
									<div class="col-4" role="group">
                                        <button type="button" class="btn body-button">
                                            <i class="fa-solid fa-plus"></i> 短路触发
                                        </button>
                                        <button type="button" class="btn body-button">
                                            <i class="fa-solid fa-plus"></i> 时间触发
                                        </button>
									</div>
								</div>
                                <div id="intelligent-tasks-grid" class="cards-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                let intelligentTasks = [
                    {
                        name: "智能任务1",
                        type: 'short_circuit',
                        id:  1,
                    },
                    {
                        name: "智能任务2",
                        type: 'time',
                        id:  2,
                        operations: [
                            {
                                time: '10:30',
                            }
                        ]
                    }
                ]; //智能任务列表

                $(document).ready(function () {
                    loadIntelligentTasksGrid();
                });

                //加载智能任务列表
                function loadIntelligentTasksGrid() {
                    const $grid = $("#intelligent-tasks-grid");
                    $grid.empty();
                    if (intelligentTasks.length) {
                        intelligentTasks.forEach((task) => {
                            const icon_src = task.type === 'short_circuit' ? 
                                '/images/icon_intelligent_short_circuit.png' : 
                                '/images/icon_intelligent_time.png';
                            const background = task.type === 'short_circuit' ?  
                                'linear-gradient(-25deg, #f8b551, #ffc467)' : 
                                'linear-gradient(-25deg, #00b7ee, #00b9ff)';
                            const $card = $(`
                                <div 
                                    class="hoverCard card" 
                                    style="background: ${background}; color: white;"
                                    id="intelligent_task_${task.id}"
                                    data-task_id="${task.id}"
                                >
                                    <div class="card-body">
                                        <div style="display: flex; justify-content: space-between;">
                                            <img loading="lazy" src="${icon_src}" class="hoverCardIcon" />
                                            <div id="intelligent_task_delete_btn_${task.id}">
                                                <i class="fa-solid fa-xmark" style="float: right; height: 20px;"></i>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 30px;">
                                            <h5 
                                                class="truncate-text"
                                                data-bs-toggle="tooltip" 
                                                data-bs-placement="bottom" 
                                                data-bs-title="${task.name}" 
                                                title="${task.name}"
                                            >
                                               ${task.name}
                                            </h5>
                                            <p>${task.type === 'time' ? `${task.operations?.length}` : '1'}个操作</p>
                                        </div>
                                    </div>
                                </div>
                            `);
                            $grid.append($card);

                            $(`#intelligent_task_${task.id}`).click(function (e) {
                                console.log('edit task: ', task);
                            });
                            $(`#intelligent_task_delete_btn_${task.id}`).click(function (e) {
                                e.stopPropagation();
                                showConfirmModal("确定要删除所选任务吗？", () => {
                                    console.log('delete task: ', task);
                                });
                            })
                        });
                    }
                }
            </script>
        </body>
    </html>
{{ end }}
